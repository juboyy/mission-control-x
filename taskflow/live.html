<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control X - Live</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Inter', -apple-system, sans-serif; 
      background: #0a0a0f; 
      color: #fff; 
      padding: 20px;
      line-height: 1.6;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { 
      font-size: 28px; 
      margin-bottom: 8px;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle { color: #888; margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .card { 
      background: rgba(255,255,255,0.03); 
      border: 1px solid rgba(255,255,255,0.1); 
      border-radius: 12px; 
      padding: 20px; 
    }
    .card h3 { font-size: 14px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
    .card .value { font-size: 32px; font-weight: 700; color: #00d4ff; }
    .card .label { font-size: 13px; color: #666; }
    .section { margin-bottom: 32px; }
    .section h2 { font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .section h2::before { content: ''; width: 4px; height: 20px; background: linear-gradient(135deg, #00d4ff, #7c3aed); border-radius: 2px; }
    .activity { 
      background: rgba(255,255,255,0.02); 
      border: 1px solid rgba(255,255,255,0.08); 
      border-radius: 8px; 
      padding: 16px; 
      margin-bottom: 8px;
      display: flex;
      gap: 12px;
    }
    .activity .icon { font-size: 20px; }
    .activity .content { flex: 1; }
    .activity .title { font-weight: 600; margin-bottom: 4px; }
    .activity .desc { font-size: 14px; color: #888; }
    .activity .meta { font-size: 12px; color: #666; margin-top: 8px; }
    .tag { 
      display: inline-block; 
      padding: 2px 8px; 
      background: rgba(0,212,255,0.1); 
      border-radius: 4px; 
      font-size: 11px; 
      margin-right: 4px;
    }
    .session { 
      background: rgba(255,255,255,0.02); 
      border: 1px solid rgba(255,255,255,0.08); 
      border-radius: 8px; 
      padding: 12px 16px; 
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .session .name { font-weight: 600; }
    .session .tokens { color: #00d4ff; font-family: monospace; }
    .live { 
      display: inline-block; 
      width: 8px; 
      height: 8px; 
      background: #22c55e; 
      border-radius: 50%; 
      animation: pulse 2s infinite;
      margin-right: 8px;
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .loading { color: #666; text-align: center; padding: 40px; }
    .error { color: #f87171; background: rgba(239,68,68,0.1); padding: 12px; border-radius: 8px; }
    #lastUpdate { font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŒ€ Mission Control X</h1>
    <p class="subtitle"><span class="live"></span>Live Dashboard â€” <span id="lastUpdate">Loading...</span></p>

    <div class="grid" id="stats">
      <div class="card"><h3>Loading...</h3></div>
    </div>

    <div class="section">
      <h2>OpenClaw Sessions</h2>
      <div id="sessions"><div class="loading">Loading sessions...</div></div>
    </div>

    <div class="section">
      <h2>Activity Feed</h2>
      <div id="activities"><div class="loading">Loading activities...</div></div>
    </div>
  </div>

  <script>
    const icons = {
      decision: 'ðŸŽ¯', system: 'âš™ï¸', memory: 'ðŸ§ ', message: 'ðŸ’¬', 
      code: 'ðŸ’»', task: 'âœ“', error: 'âš ï¸', file: 'ðŸ“„', search: 'ðŸ”'
    };

    async function load() {
      try {
        // Fetch all data
        const [stats, session, sessions, activities] = await Promise.all([
          fetch('/api/stats').then(r => r.json()),
          fetch('/api/session').then(r => r.json()),
          fetch('/api/openclaw/sessions').then(r => r.json()),
          fetch('/api/activities').then(r => r.json()),
        ]);

        // Render stats
        document.getElementById('stats').innerHTML = `
          <div class="card">
            <h3>Agent</h3>
            <div class="value">${session.avatar || 'ðŸŒ€'}</div>
            <div class="label">${session.agent || 'Imu'} â€¢ ${session.status || 'Online'}</div>
          </div>
          <div class="card">
            <h3>Decisions</h3>
            <div class="value">${stats.tasks || 0}</div>
            <div class="label">Total logged</div>
          </div>
          <div class="card">
            <h3>Files</h3>
            <div class="value">${stats.files || 0}</div>
            <div class="label">In workspace</div>
          </div>
          <div class="card">
            <h3>Sessions</h3>
            <div class="value">${sessions.length || 0}</div>
            <div class="label">Active</div>
          </div>
        `;

        // Render sessions
        document.getElementById('sessions').innerHTML = sessions.map(s => `
          <div class="session">
            <div>
              <span class="name">${s.label || s.key.split(':').pop()}</span>
              <span class="tag">${s.channel || 'unknown'}</span>
            </div>
            <div class="tokens">${(s.totalTokens || 0).toLocaleString()} tokens</div>
          </div>
        `).join('') || '<div class="loading">No sessions</div>';

        // Render activities
        document.getElementById('activities').innerHTML = activities.slice(0, 20).map(a => `
          <div class="activity">
            <div class="icon">${icons[a.type] || 'ðŸ“Œ'}</div>
            <div class="content">
              <div class="title">${a.title || 'Activity'}</div>
              <div class="desc">${a.description || ''}</div>
              <div class="meta">
                ${(a.tags || []).map(t => `<span class="tag">${t}</span>`).join('')}
                ${a.timestamp ? new Date(a.timestamp).toLocaleString('pt-BR') : ''}
              </div>
            </div>
          </div>
        `).join('') || '<div class="loading">No activities</div>';

        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('pt-BR');

      } catch (e) {
        console.error(e);
        document.getElementById('stats').innerHTML = `<div class="error">Error: ${e.message}</div>`;
      }
    }

    // Load now and every 30s
    load();
    setInterval(load, 30000);
  </script>
</body>
</html>
